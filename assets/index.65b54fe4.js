import{u as ke}from"./detail.1f88fcb0.js";import{u as ze}from"./setting.74a9bb05.js";import{f as se,d as V,g as H,r as j,h as Se,j as Re,k as p,l as ve,w as z,m as Ce,n as _e,p as $e,o as le,q as Oe,s as Ee,t as Ae,v as Me,x as Te,c as m,y as Z,z as ne,A as N,B as ee,C as ge,D as de,E as ae,G as M,H as me,I as Ze,J as te,K as ue,L as Be,M as He,N as Ie,T as he,O as Le,P as fe,Q as We,R as Ne,S as Fe,U as we,V as xe,W as Ue,X as Ve,Y as je,Z as qe,$ as Ke,a0 as ye,a as A,b as Ge,a1 as Je,_ as pe,u as Qe,F as et}from"./index.8833a027.js";import{m as tt,u as ot}from"./mount-component.07babac7.js";const[Ye,oe]=se("swipe"),at={loop:Z,width:ne,height:ne,vertical:Boolean,autoplay:N(0),duration:N(500),touchable:Z,lazyRender:Boolean,initialSwipe:N(0),indicatorColor:String,showIndicators:Z,stopPropagation:Z},Xe=Symbol(Ye);var it=V({name:Ye,props:at,emits:["change","dragStart","dragEnd"],setup(e,{emit:u,slots:i}){const t=H(),o=H(),a=j({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let C=!1;const v=Se(),{children:d,linkChildren:g}=Re(Xe),c=p(()=>d.length),n=p(()=>a[e.vertical?"height":"width"]),r=p(()=>e.vertical?v.deltaY.value:v.deltaX.value),x=p(()=>a.rect?(e.vertical?a.rect.height:a.rect.width)-n.value*c.value:0),b=p(()=>n.value?Math.ceil(Math.abs(x.value)/n.value):c.value),_=p(()=>c.value*n.value),S=p(()=>(a.active+c.value)%c.value),Y=p(()=>{const l=e.vertical?"vertical":"horizontal";return v.direction.value===l}),w=p(()=>{const l={transitionDuration:`${a.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+a.offset.toFixed(2)}px)`};if(n.value){const y=e.vertical?"height":"width",P=e.vertical?"width":"height";l[y]=`${_.value}px`,l[P]=e[P]?`${e[P]}px`:""}return l}),R=l=>{const{active:y}=a;return l?e.loop?M(y+l,-1,c.value):M(y+l,0,b.value):y},$=(l,y=0)=>{let P=l*n.value;e.loop||(P=Math.min(P,-x.value));let k=y-P;return e.loop||(k=M(k,x.value,0)),k},D=({pace:l=0,offset:y=0,emitChange:P})=>{if(c.value<=1)return;const{active:k}=a,X=R(l),K=$(X,y);if(e.loop){if(d[0]&&K!==x.value){const ce=K<x.value;d[0].setOffset(ce?_.value:0)}if(d[c.value-1]&&K!==0){const ce=K>0;d[c.value-1].setOffset(ce?-_.value:0)}}a.active=X,a.offset=K,P&&X!==k&&u("change",S.value)},E=()=>{a.swiping=!0,a.active<=-1?D({pace:c.value}):a.active>=c.value&&D({pace:-c.value})},G=()=>{E(),v.reset(),ee(()=>{a.swiping=!1,D({pace:-1,emitChange:!0})})},F=()=>{E(),v.reset(),ee(()=>{a.swiping=!1,D({pace:1,emitChange:!0})})};let J;const L=()=>clearTimeout(J),W=()=>{L(),+e.autoplay>0&&c.value>1&&(J=setTimeout(()=>{F(),W()},+e.autoplay))},B=(l=+e.initialSwipe)=>{if(!t.value)return;const y=()=>{var P,k;if(!ge(t)){const X={width:t.value.offsetWidth,height:t.value.offsetHeight};a.rect=X,a.width=+((P=e.width)!=null?P:X.width),a.height=+((k=e.height)!=null?k:X.height)}c.value&&(l=Math.min(c.value-1,l),l===-1&&(l=c.value-1)),a.active=l,a.swiping=!0,a.offset=$(l),d.forEach(X=>{X.setOffset(0)}),W()};ge(t)?de().then(y):y()},q=()=>B(a.active);let Q;const s=l=>{!e.touchable||l.touches.length>1||(v.start(l),C=!1,Q=Date.now(),L(),E())},f=l=>{e.touchable&&a.swiping&&(v.move(l),Y.value&&(!e.loop&&(a.active===0&&r.value>0||a.active===c.value-1&&r.value<0)||(ae(l,e.stopPropagation),D({offset:r.value}),C||(u("dragStart",{index:S.value}),C=!0))))},h=()=>{if(!e.touchable||!a.swiping)return;const l=Date.now()-Q,y=r.value/l;if((Math.abs(y)>.25||Math.abs(r.value)>n.value/2)&&Y.value){const k=e.vertical?v.offsetY.value:v.offsetX.value;let X=0;e.loop?X=k>0?r.value>0?-1:1:0:X=-Math[r.value>0?"ceil":"floor"](r.value/n.value),D({pace:X,emitChange:!0})}else r.value&&D({pace:0});C=!1,a.swiping=!1,u("dragEnd",{index:S.value}),W()},T=(l,y={})=>{E(),v.reset(),ee(()=>{let P;e.loop&&l===c.value?P=a.active===0?0:l:P=l%c.value,y.immediate?ee(()=>{a.swiping=!1}):a.swiping=!1,D({pace:P-a.active,emitChange:!0})})},I=(l,y)=>{const P=y===S.value,k=P?{backgroundColor:e.indicatorColor}:void 0;return m("i",{style:k,class:oe("indicator",{active:P})},null)},O=()=>{if(i.indicator)return i.indicator({active:S.value,total:c.value});if(e.showIndicators&&c.value>1)return m("div",{class:oe("indicators",{vertical:e.vertical})},[Array(c.value).fill("").map(I)])};return ve({prev:G,next:F,state:a,resize:q,swipeTo:T}),g({size:n,props:e,count:c,activeIndicator:S}),z(()=>e.initialSwipe,l=>B(+l)),z(c,()=>B(a.active)),z(()=>e.autoplay,W),z([Ce,_e,()=>e.width,()=>e.height],q),z($e(),l=>{l==="visible"?W():L()}),le(B),Oe(()=>B(a.active)),Ee(()=>B(a.active)),Ae(L),Me(L),Te("touchmove",f,{target:o}),()=>{var l;return m("div",{ref:t,class:oe()},[m("div",{ref:o,style:w.value,class:oe("track",{vertical:e.vertical}),onTouchstartPassive:s,onTouchend:h,onTouchcancel:h},[(l=i.default)==null?void 0:l.call(i)]),O()])}}});const nt=me(it),[st,lt]=se("swipe-item");var ct=V({name:st,setup(e,{slots:u}){let i;const t=j({offset:0,inited:!1,mounted:!1}),{parent:o,index:a}=Ze(Xe);if(!o)return;const C=p(()=>{const g={},{vertical:c}=o.props;return o.size.value&&(g[c?"height":"width"]=`${o.size.value}px`),t.offset&&(g.transform=`translate${c?"Y":"X"}(${t.offset}px)`),g}),v=p(()=>{const{loop:g,lazyRender:c}=o.props;if(!c||i)return!0;if(!t.mounted)return!1;const n=o.activeIndicator.value,r=o.count.value-1,x=n===0&&g?r:n-1,b=n===r&&g?0:n+1;return i=a.value===n||a.value===x||a.value===b,i}),d=g=>{t.offset=g};return le(()=>{de(()=>{t.mounted=!0})}),ve({setOffset:d}),()=>{var g;return m("div",{class:lt(),style:C.value},[v.value?(g=u.default)==null?void 0:g.call(u):null])}}});const rt=me(ct),be=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ut=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),re=se("image-preview")[1],Pe=2.6;var vt=V({props:{src:String,show:Boolean,active:Number,minZoom:te(ne),maxZoom:te(ne),rootWidth:te(Number),rootHeight:te(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean},emits:["scale","close","longPress"],setup(e,{emit:u,slots:i}){const t=j({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),o=Se(),a=H(),C=H(),v=H(!1),d=H(!1);let g=0;const c=p(()=>{const{scale:s,moveX:f,moveY:h,moving:T,zooming:I,initializing:O}=t,l={transitionDuration:I||T||O?"0s":".3s"};return(s!==1||d.value)&&(l.transform=`matrix(${s}, 0, 0, ${s}, ${f}, ${h})`),l}),n=p(()=>{if(t.imageRatio){const{rootWidth:s,rootHeight:f}=e,h=v.value?f/t.imageRatio:s;return Math.max(0,(t.scale*h-s)/2)}return 0}),r=p(()=>{if(t.imageRatio){const{rootWidth:s,rootHeight:f}=e,h=v.value?f:s*t.imageRatio;return Math.max(0,(t.scale*h-f)/2)}return 0}),x=(s,f)=>{var h;if(s=M(s,+e.minZoom,+e.maxZoom+1),s!==t.scale){const T=s/t.scale;if(t.scale=s,f){const I=Ie((h=a.value)==null?void 0:h.$el),O={x:I.width*.5,y:I.height*.5},l=t.moveX-(f.x-I.left-O.x)*(T-1),y=t.moveY-(f.y-I.top-O.y)*(T-1);t.moveX=M(l,-n.value,n.value),t.moveY=M(y,-r.value,r.value)}else t.moveX=0,t.moveY=d.value?g:0;u("scale",{scale:s,index:e.active})}},b=()=>{x(1)},_=()=>{const s=t.scale>1?1:2;x(s,s===2||d.value?{x:o.startX.value,y:o.startY.value}:void 0)};let S,Y,w,R,$,D,E,G,F=!1;const J=s=>{const{touches:f}=s;if(S=f.length,S===2&&e.disableZoom)return;const{offsetX:h}=o;o.start(s),Y=t.moveX,w=t.moveY,G=Date.now(),F=!1,t.moving=S===1&&(t.scale!==1||d.value),t.zooming=S===2&&!h.value,t.zooming&&(R=t.scale,$=be(f))},L=s=>{const{touches:f}=s;if(o.move(s),t.moving){const{deltaX:h,deltaY:T}=o,I=h.value+Y,O=T.value+w;if((I>n.value||I<-n.value)&&!F&&o.isHorizontal()){t.moving=!1;return}F=!0,ae(s,!0),t.moveX=M(I,-n.value,n.value),t.moveY=M(O,-r.value,r.value)}if(t.zooming&&(ae(s,!0),f.length===2)){const h=be(f),T=R*h/$;D=ut(f),x(T,D)}},W=s=>{var f;if(S>1)return;const{offsetX:h,offsetY:T}=o,I=Date.now()-G,O=250;if(h.value<he&&T.value<he)if(I<O)if(e.doubleScale)if(E)clearTimeout(E),E=null,_();else{if(!e.closeOnClickOverlay&&s.target===((f=C.value)==null?void 0:f.$el))return;E=setTimeout(()=>{u("close"),E=null},O)}else u("close");else I>Le&&u("longPress")},B=s=>{let f=!1;if((t.moving||t.zooming)&&(f=!0,t.moving&&Y===t.moveX&&w===t.moveY&&(f=!1),!s.touches.length)){t.zooming&&(t.moveX=M(t.moveX,-n.value,n.value),t.moveY=M(t.moveY,-r.value,r.value),t.zooming=!1),t.moving=!1,Y=0,w=0,R=1,t.scale<1&&b();const h=+e.maxZoom;t.scale>h&&x(h,D)}ae(s,f),W(s),o.reset()},q=()=>{const{rootWidth:s,rootHeight:f}=e,h=f/s,{imageRatio:T}=t;v.value=t.imageRatio>h&&T<Pe,d.value=t.imageRatio>h&&T>=Pe,d.value&&(g=(T*s-f)/2,t.moveY=g,t.initializing=!0,Be(()=>{t.initializing=!1})),b()},Q=s=>{const{naturalWidth:f,naturalHeight:h}=s.target;t.imageRatio=h/f,q()};return z(()=>e.active,b),z(()=>e.show,s=>{s||b()}),z(()=>[e.rootWidth,e.rootHeight],q),Te("touchmove",L,{target:p(()=>{var s;return(s=C.value)==null?void 0:s.$el})}),()=>{const s={loading:()=>m(He,{type:"spinner"},null)};return m(rt,{ref:C,class:re("swipe-item"),onTouchstartPassive:J,onTouchend:B,onTouchcancel:B},{default:()=>[i.image?m("div",{class:re("image-wrap")},[i.image({src:e.src})]):m(ue,{ref:a,src:e.src,fit:"contain",class:re("image",{vertical:v.value}),style:c.value,onLoad:Q},s)]})}}});const[dt,U]=se("image-preview"),mt=["show","teleport","transition","overlayStyle","closeOnPopstate"],ft={show:Boolean,loop:Z,images:Fe(),minZoom:N(1/3),maxZoom:N(3),overlay:Z,closeable:Boolean,showIndex:Z,className:we,closeIcon:xe("clear"),transition:String,beforeClose:Function,doubleScale:Z,overlayClass:we,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:Z,closeOnClickOverlay:Z,closeIconPosition:xe("top-right"),teleport:[String,Object]};var De=V({name:dt,props:ft,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:u,slots:i}){const t=H(),o=j({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),a=()=>{if(t.value){const w=Ie(t.value.$el);o.rootWidth=w.width,o.rootHeight=w.height,t.value.resize()}},C=w=>u("scale",w),v=w=>u("update:show",w),d=()=>{je(e.beforeClose,{args:[o.active],done:()=>v(!1)})},g=w=>{w!==o.active&&(o.active=w,u("change",w))},c=()=>{if(e.showIndex)return m("div",{class:U("index")},[i.index?i.index({index:o.active}):`${o.active+1} / ${e.images.length}`])},n=()=>{if(i.cover)return m("div",{class:U("cover")},[i.cover()])},r=()=>{o.disableZoom=!0},x=()=>{o.disableZoom=!1},b=()=>m(nt,{ref:t,lazyRender:!0,loop:e.loop,class:U("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:g,onDragEnd:x,onDragStart:r},{default:()=>[e.images.map((w,R)=>m(vt,{src:w,show:e.show,active:o.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:o.rootWidth,rootHeight:o.rootHeight,disableZoom:o.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:C,onClose:d,onLongPress:()=>u("longPress",{index:R})},{image:i.image}))]}),_=()=>{if(e.closeable)return m(Ve,{role:"button",name:e.closeIcon,class:[U("close-icon",e.closeIconPosition),Ue],onClick:d},null)},S=()=>u("closed"),Y=(w,R)=>{var $;return($=t.value)==null?void 0:$.swipeTo(w,R)};return ve({swipeTo:Y}),le(a),z([Ce,_e],a),z(()=>e.startPosition,w=>g(+w)),z(()=>e.show,w=>{const{images:R,startPosition:$}=e;w?(g(+$),de(()=>{a(),Y(+$,{immediate:!0})})):u("close",{index:o.active,url:R[o.active]})}),()=>m(Ne,fe({class:[U(),e.className],overlayClass:[U("overlay"),e.overlayClass],onClosed:S,"onUpdate:show":v},We(e,mt)),{default:()=>[_(),b(),c(),n()]})}});let ie;const gt={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function ht(){({instance:ie}=tt({setup(){const{state:e,toggle:u}=ot(),i=()=>{e.images=[]};return()=>m(De,fe(e,{onClosed:i,"onUpdate:show":u}),null)}}))}const wt=(e,u=0)=>{if(!!qe)return ie||ht(),e=Array.isArray(e)?{images:e,startPosition:u}:e,ie.open(Ke({},gt,e)),ie};me(De);const xt={show:Boolean,images:Array,startPosition:Number},yt=e=>{const i=Je(m(Pt,fe(e,{show:!0,onClose:()=>{i.unmount(),document.body.removeChild(t)}}),null)),t=document.createElement("div");document.body.appendChild(t),i.mount(t)},bt=V({name:"ImagePreview",props:xt,components:{[ye.name]:ye,[ue.name]:ue},emits:["update:show","close"],setup(e,{emit:u}){const i=j({visible:e.show,startX:0,moveX:0,startY:0,moveY:0,index:e.startPosition||0});z(()=>e.show,v=>i.visible=v);const t=()=>{i.visible=!1,u("close",!1),u("update:show",!1)},o=v=>{var d,g,c,n;i.startX=(g=(d=v.touches)==null?void 0:d[0])==null?void 0:g.pageX,i.startY=(n=(c=v.touches)==null?void 0:c[0])==null?void 0:n.pageY},a=v=>{var d,g,c,n;i.moveX=((g=(d=v.touches)==null?void 0:d[0])==null?void 0:g.pageX)-i.startX,i.moveY=i.startY-((n=(c=v.touches)==null?void 0:c[0])==null?void 0:n.pageY)},C=v=>{var d;i.moveX<-30?console.log("\u5411\u5DE6\u6ED1\u52A8"):i.moveX>30?console.log("\u5411\u53F3\u6ED1\u52A8"):i.moveY>30?(console.log("\u5411\u4E0A\u6ED1\u52A8"),i.index<(((d=e.images)==null?void 0:d.length)||0)&&i.index++,console.log(i.index)):i.moveY<-30&&(console.log("\u5411\u4E0B\u6ED1\u52A8"),i.index>0&&i.index--,console.log(i.index))};return()=>m(A("van-overlay"),{show:i.visible,"z-index":"9999","custom-style":{background:"#000"},onClick:t},{default:()=>{var v,d;return[m("div",{class:"imgBox",onTouchstart:o,onTouchmove:a,onTouchend:C},[m("div",{class:"page"},[i.index+1,Ge(" / "),(v=e.images)==null?void 0:v.length]),m(A("van-image"),{width:"100%",height:"100vh",fit:"contain",src:(d=e.images)==null?void 0:d[i.index]},null)])]}})}});const Pt=pe(bt,[["__scopeId","data-v-f61de822"]]),St=V({setup(){const e=ke(),u=ze(),i=Qe(),t=H(),o=j({allData:e.item,showPopover:!1,actions:[{text:"\u5207\u6362\u5C0F\u5C4F",key:"0"},{text:"\u5207\u6362\u5927\u5C4F",key:"1"},{text:"\u52A8\u753B\u5207\u6362",key:"2"}],showImage:!1,imgList:[],startPosition:0}),a=H();le(()=>{v()});const C=n=>{let r=n.split("/");return r[2]?r=r[2]:r="",r},v=()=>{var n,r;u.domain&&((r=(n=o.allData)==null?void 0:n.children)==null||r.forEach(x=>{var b;x.href=(b=x.href)==null?void 0:b.replace(C(x.href),u.domain)})),console.log(o.allData)},d=()=>{i.go(-1)},g=n=>{var r,x;o.imgList=(x=(r=o.allData)==null?void 0:r.children)==null?void 0:x.map(b=>b.href),o.startPosition=n,u.isAnimation?wt({images:o.imgList,startPosition:o.startPosition,onChange:b=>{var _;(_=t.value)==null||_.scrollTo(b)}}):yt({images:o.imgList,startPosition:o.startPosition})},c=n=>{n.key==="0"&&(u.isSmallScreen=!0),n.key==="1"&&(u.isSmallScreen=!1),n.key==="2"&&(u.isAnimation=!0)};return()=>{var n,r,x,b;return m(et,null,[m(A("van-nav-bar"),{title:"\u6700\u65B0","left-text":"\u8FD4\u56DE","left-arrow":!0,onClickLeft:d},null),m("div",{class:"content"},[m("p",{class:"title"},[((n=o.allData)==null?void 0:n.intro)||((r=o.allData)==null?void 0:r.title)]),m(A("van-index-bar"),{ref:t,"index-list":(b=(x=o.allData)==null?void 0:x.children)==null?void 0:b.map((_,S)=>S)},{default:()=>{var _;return[(_=o.allData)==null?void 0:_.children.map((S,Y)=>m(A("van-index-anchor"),{index:Y},{default:()=>[m(A("van-image"),{class:"img",width:"100%",height:u.isSmallScreen?"100%":"100vh",src:S.href,fit:"contain",onClick:()=>g(Y)},{loading:()=>m(A("van-loading"),{type:"spinner",size:"20"},null),error:()=>"\u52A0\u8F7D\u5931\u8D25"})]}))]}})]),m(A("van-floating-bubble"),{icon:"setting-o",ref:a,axis:"xy"},{default:()=>m(A("van-popover"),{show:o.showPopover,"onUpdate:show":_=>o.showPopover=_,actions:o.actions,placement:"left",theme:"dark","actions-direction":"horizontal",onSelect:c},{reference:()=>m(A("van-icon"),{name:"setting-o",size:"24"},null)})})])}}});const pt=pe(St,[["__scopeId","data-v-5e962401"]]);export{pt as default};
