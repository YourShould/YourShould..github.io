import{u as De}from"./detail.7553b181.js";import{u as ze}from"./setting.9a11b130.js";import{f as se,d as V,g as B,r as j,h as Se,j as $e,k as _,l as ve,w as X,m as Ce,n as _e,p as Oe,o as le,q as Re,s as Ee,t as Ae,v as Me,x as Te,c as f,y as A,z as ne,A as N,B as ee,C as ge,D as me,E as ae,G as E,H as de,I as Ze,J as te,K as ue,L as Be,M as He,N as Ie,T as he,O as Le,P as fe,Q as We,R as Ne,S as Fe,U as we,V as ye,W as Ue,X as Ve,Y as je,Z as qe,$ as Ke,a0 as xe,a as Z,b as Ge,a1 as Je,_ as pe,u as Qe,F as et}from"./index.4c9305dc.js";import{m as tt,u as ot}from"./mount-component.c8a1e165.js";const[Ye,oe]=se("swipe"),at={loop:A,width:ne,height:ne,vertical:Boolean,autoplay:N(0),duration:N(500),touchable:A,lazyRender:Boolean,initialSwipe:N(0),indicatorColor:String,showIndicators:A,stopPropagation:A},Xe=Symbol(Ye);var it=V({name:Ye,props:at,emits:["change","dragStart","dragEnd"],setup(e,{emit:r,slots:n}){const t=B(),c=B(),a=j({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let P=!1;const u=Se(),{children:v,linkChildren:g}=$e(Xe),o=_(()=>v.length),i=_(()=>a[e.vertical?"height":"width"]),m=_(()=>e.vertical?u.deltaY.value:u.deltaX.value),y=_(()=>a.rect?(e.vertical?a.rect.height:a.rect.width)-i.value*o.value:0),$=_(()=>i.value?Math.ceil(Math.abs(y.value)/i.value):o.value),H=_(()=>o.value*i.value),T=_(()=>(a.active+o.value)%o.value),O=_(()=>{const l=e.vertical?"vertical":"horizontal";return u.direction.value===l}),w=_(()=>{const l={transitionDuration:`${a.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+a.offset.toFixed(2)}px)`};if(i.value){const x=e.vertical?"height":"width",b=e.vertical?"width":"height";l[x]=`${H.value}px`,l[b]=e[b]?`${e[b]}px`:""}return l}),k=l=>{const{active:x}=a;return l?e.loop?E(x+l,-1,o.value):E(x+l,0,$.value):x},D=(l,x=0)=>{let b=l*i.value;e.loop||(b=Math.min(b,-y.value));let Y=x-b;return e.loop||(Y=E(Y,y.value,0)),Y},p=({pace:l=0,offset:x=0,emitChange:b})=>{if(o.value<=1)return;const{active:Y}=a,I=k(l),K=D(I,x);if(e.loop){if(v[0]&&K!==y.value){const ce=K<y.value;v[0].setOffset(ce?H.value:0)}if(v[o.value-1]&&K!==0){const ce=K>0;v[o.value-1].setOffset(ce?-H.value:0)}}a.active=I,a.offset=K,b&&I!==Y&&r("change",T.value)},R=()=>{a.swiping=!0,a.active<=-1?p({pace:o.value}):a.active>=o.value&&p({pace:-o.value})},G=()=>{R(),u.reset(),ee(()=>{a.swiping=!1,p({pace:-1,emitChange:!0})})},F=()=>{R(),u.reset(),ee(()=>{a.swiping=!1,p({pace:1,emitChange:!0})})};let J;const L=()=>clearTimeout(J),W=()=>{L(),+e.autoplay>0&&o.value>1&&(J=setTimeout(()=>{F(),W()},+e.autoplay))},M=(l=+e.initialSwipe)=>{if(!t.value)return;const x=()=>{var b,Y;if(!ge(t)){const I={width:t.value.offsetWidth,height:t.value.offsetHeight};a.rect=I,a.width=+((b=e.width)!=null?b:I.width),a.height=+((Y=e.height)!=null?Y:I.height)}o.value&&(l=Math.min(o.value-1,l),l===-1&&(l=o.value-1)),a.active=l,a.swiping=!0,a.offset=D(l),v.forEach(I=>{I.setOffset(0)}),W()};ge(t)?me().then(x):x()},q=()=>M(a.active);let Q;const s=l=>{!e.touchable||l.touches.length>1||(u.start(l),P=!1,Q=Date.now(),L(),R())},d=l=>{e.touchable&&a.swiping&&(u.move(l),O.value&&(!e.loop&&(a.active===0&&m.value>0||a.active===o.value-1&&m.value<0)||(ae(l,e.stopPropagation),p({offset:m.value}),P||(r("dragStart",{index:T.value}),P=!0))))},h=()=>{if(!e.touchable||!a.swiping)return;const l=Date.now()-Q,x=m.value/l;if((Math.abs(x)>.25||Math.abs(m.value)>i.value/2)&&O.value){const Y=e.vertical?u.offsetY.value:u.offsetX.value;let I=0;e.loop?I=Y>0?m.value>0?-1:1:0:I=-Math[m.value>0?"ceil":"floor"](m.value/i.value),p({pace:I,emitChange:!0})}else m.value&&p({pace:0});P=!1,a.swiping=!1,r("dragEnd",{index:T.value}),W()},S=(l,x={})=>{R(),u.reset(),ee(()=>{let b;e.loop&&l===o.value?b=a.active===0?0:l:b=l%o.value,x.immediate?ee(()=>{a.swiping=!1}):a.swiping=!1,p({pace:b-a.active,emitChange:!0})})},C=(l,x)=>{const b=x===T.value,Y=b?{backgroundColor:e.indicatorColor}:void 0;return f("i",{style:Y,class:oe("indicator",{active:b})},null)},z=()=>{if(n.indicator)return n.indicator({active:T.value,total:o.value});if(e.showIndicators&&o.value>1)return f("div",{class:oe("indicators",{vertical:e.vertical})},[Array(o.value).fill("").map(C)])};return ve({prev:G,next:F,state:a,resize:q,swipeTo:S}),g({size:i,props:e,count:o,activeIndicator:T}),X(()=>e.initialSwipe,l=>M(+l)),X(o,()=>M(a.active)),X(()=>e.autoplay,W),X([Ce,_e,()=>e.width,()=>e.height],q),X(Oe(),l=>{l==="visible"?W():L()}),le(M),Re(()=>M(a.active)),Ee(()=>M(a.active)),Ae(L),Me(L),Te("touchmove",d,{target:c}),()=>{var l;return f("div",{ref:t,class:oe()},[f("div",{ref:c,style:w.value,class:oe("track",{vertical:e.vertical}),onTouchstartPassive:s,onTouchend:h,onTouchcancel:h},[(l=n.default)==null?void 0:l.call(n)]),z()])}}});const nt=de(it),[st,lt]=se("swipe-item");var ct=V({name:st,setup(e,{slots:r}){let n;const t=j({offset:0,inited:!1,mounted:!1}),{parent:c,index:a}=Ze(Xe);if(!c)return;const P=_(()=>{const g={},{vertical:o}=c.props;return c.size.value&&(g[o?"height":"width"]=`${c.size.value}px`),t.offset&&(g.transform=`translate${o?"Y":"X"}(${t.offset}px)`),g}),u=_(()=>{const{loop:g,lazyRender:o}=c.props;if(!o||n)return!0;if(!t.mounted)return!1;const i=c.activeIndicator.value,m=c.count.value-1,y=i===0&&g?m:i-1,$=i===m&&g?0:i+1;return n=a.value===i||a.value===y||a.value===$,n}),v=g=>{t.offset=g};return le(()=>{me(()=>{t.mounted=!0})}),ve({setOffset:v}),()=>{var g;return f("div",{class:lt(),style:P.value},[u.value?(g=r.default)==null?void 0:g.call(r):null])}}});const rt=de(ct),be=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ut=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),re=se("image-preview")[1],Pe=2.6;var vt=V({props:{src:String,show:Boolean,active:Number,minZoom:te(ne),maxZoom:te(ne),rootWidth:te(Number),rootHeight:te(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean},emits:["scale","close","longPress"],setup(e,{emit:r,slots:n}){const t=j({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),c=Se(),a=B(),P=B(),u=B(!1),v=B(!1);let g=0;const o=_(()=>{const{scale:s,moveX:d,moveY:h,moving:S,zooming:C,initializing:z}=t,l={transitionDuration:C||S||z?"0s":".3s"};return(s!==1||v.value)&&(l.transform=`matrix(${s}, 0, 0, ${s}, ${d}, ${h})`),l}),i=_(()=>{if(t.imageRatio){const{rootWidth:s,rootHeight:d}=e,h=u.value?d/t.imageRatio:s;return Math.max(0,(t.scale*h-s)/2)}return 0}),m=_(()=>{if(t.imageRatio){const{rootWidth:s,rootHeight:d}=e,h=u.value?d:s*t.imageRatio;return Math.max(0,(t.scale*h-d)/2)}return 0}),y=(s,d)=>{var h;if(s=E(s,+e.minZoom,+e.maxZoom+1),s!==t.scale){const S=s/t.scale;if(t.scale=s,d){const C=Ie((h=a.value)==null?void 0:h.$el),z={x:C.width*.5,y:C.height*.5},l=t.moveX-(d.x-C.left-z.x)*(S-1),x=t.moveY-(d.y-C.top-z.y)*(S-1);t.moveX=E(l,-i.value,i.value),t.moveY=E(x,-m.value,m.value)}else t.moveX=0,t.moveY=v.value?g:0;r("scale",{scale:s,index:e.active})}},$=()=>{y(1)},H=()=>{const s=t.scale>1?1:2;y(s,s===2||v.value?{x:c.startX.value,y:c.startY.value}:void 0)};let T,O,w,k,D,p,R,G,F=!1;const J=s=>{const{touches:d}=s;if(T=d.length,T===2&&e.disableZoom)return;const{offsetX:h}=c;c.start(s),O=t.moveX,w=t.moveY,G=Date.now(),F=!1,t.moving=T===1&&(t.scale!==1||v.value),t.zooming=T===2&&!h.value,t.zooming&&(k=t.scale,D=be(d))},L=s=>{const{touches:d}=s;if(c.move(s),t.moving){const{deltaX:h,deltaY:S}=c,C=h.value+O,z=S.value+w;if((C>i.value||C<-i.value)&&!F&&c.isHorizontal()){t.moving=!1;return}F=!0,ae(s,!0),t.moveX=E(C,-i.value,i.value),t.moveY=E(z,-m.value,m.value)}if(t.zooming&&(ae(s,!0),d.length===2)){const h=be(d),S=k*h/D;p=ut(d),y(S,p)}},W=s=>{var d;if(T>1)return;const{offsetX:h,offsetY:S}=c,C=Date.now()-G,z=250;if(h.value<he&&S.value<he)if(C<z)if(e.doubleScale)if(R)clearTimeout(R),R=null,H();else{if(!e.closeOnClickOverlay&&s.target===((d=P.value)==null?void 0:d.$el))return;R=setTimeout(()=>{r("close"),R=null},z)}else r("close");else C>Le&&r("longPress")},M=s=>{let d=!1;if((t.moving||t.zooming)&&(d=!0,t.moving&&O===t.moveX&&w===t.moveY&&(d=!1),!s.touches.length)){t.zooming&&(t.moveX=E(t.moveX,-i.value,i.value),t.moveY=E(t.moveY,-m.value,m.value),t.zooming=!1),t.moving=!1,O=0,w=0,k=1,t.scale<1&&$();const h=+e.maxZoom;t.scale>h&&y(h,p)}ae(s,d),W(s),c.reset()},q=()=>{const{rootWidth:s,rootHeight:d}=e,h=d/s,{imageRatio:S}=t;u.value=t.imageRatio>h&&S<Pe,v.value=t.imageRatio>h&&S>=Pe,v.value&&(g=(S*s-d)/2,t.moveY=g,t.initializing=!0,Be(()=>{t.initializing=!1})),$()},Q=s=>{const{naturalWidth:d,naturalHeight:h}=s.target;t.imageRatio=h/d,q()};return X(()=>e.active,$),X(()=>e.show,s=>{s||$()}),X(()=>[e.rootWidth,e.rootHeight],q),Te("touchmove",L,{target:_(()=>{var s;return(s=P.value)==null?void 0:s.$el})}),()=>{const s={loading:()=>f(He,{type:"spinner"},null)};return f(rt,{ref:P,class:re("swipe-item"),onTouchstartPassive:J,onTouchend:M,onTouchcancel:M},{default:()=>[n.image?f("div",{class:re("image-wrap")},[n.image({src:e.src})]):f(ue,{ref:a,src:e.src,fit:"contain",class:re("image",{vertical:u.value}),style:o.value,onLoad:Q},s)]})}}});const[mt,U]=se("image-preview"),dt=["show","teleport","transition","overlayStyle","closeOnPopstate"],ft={show:Boolean,loop:A,images:Fe(),minZoom:N(1/3),maxZoom:N(3),overlay:A,closeable:Boolean,showIndex:A,className:we,closeIcon:ye("clear"),transition:String,beforeClose:Function,doubleScale:A,overlayClass:we,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:A,closeOnClickOverlay:A,closeIconPosition:ye("top-right"),teleport:[String,Object]};var ke=V({name:mt,props:ft,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:r,slots:n}){const t=B(),c=j({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),a=()=>{if(t.value){const w=Ie(t.value.$el);c.rootWidth=w.width,c.rootHeight=w.height,t.value.resize()}},P=w=>r("scale",w),u=w=>r("update:show",w),v=()=>{je(e.beforeClose,{args:[c.active],done:()=>u(!1)})},g=w=>{w!==c.active&&(c.active=w,r("change",w))},o=()=>{if(e.showIndex)return f("div",{class:U("index")},[n.index?n.index({index:c.active}):`${c.active+1} / ${e.images.length}`])},i=()=>{if(n.cover)return f("div",{class:U("cover")},[n.cover()])},m=()=>{c.disableZoom=!0},y=()=>{c.disableZoom=!1},$=()=>f(nt,{ref:t,lazyRender:!0,loop:e.loop,class:U("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:g,onDragEnd:y,onDragStart:m},{default:()=>[e.images.map((w,k)=>f(vt,{src:w,show:e.show,active:c.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:c.rootWidth,rootHeight:c.rootHeight,disableZoom:c.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:P,onClose:v,onLongPress:()=>r("longPress",{index:k})},{image:n.image}))]}),H=()=>{if(e.closeable)return f(Ve,{role:"button",name:e.closeIcon,class:[U("close-icon",e.closeIconPosition),Ue],onClick:v},null)},T=()=>r("closed"),O=(w,k)=>{var D;return(D=t.value)==null?void 0:D.swipeTo(w,k)};return ve({swipeTo:O}),le(a),X([Ce,_e],a),X(()=>e.startPosition,w=>g(+w)),X(()=>e.show,w=>{const{images:k,startPosition:D}=e;w?(g(+D),me(()=>{a(),O(+D,{immediate:!0})})):r("close",{index:c.active,url:k[c.active]})}),()=>f(Ne,fe({class:[U(),e.className],overlayClass:[U("overlay"),e.overlayClass],onClosed:T,"onUpdate:show":u},We(e,dt)),{default:()=>[H(),$(),o(),i()]})}});let ie;const gt={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function ht(){({instance:ie}=tt({setup(){const{state:e,toggle:r}=ot(),n=()=>{e.images=[]};return()=>f(ke,fe(e,{onClosed:n,"onUpdate:show":r}),null)}}))}const wt=(e,r=0)=>{if(!!qe)return ie||ht(),e=Array.isArray(e)?{images:e,startPosition:r}:e,ie.open(Ke({},gt,e)),ie};de(ke);const yt={show:Boolean,images:Array,startPosition:Number},xt=e=>{const n=Je(f(Pt,fe(e,{show:!0,onClose:()=>{n.unmount(),document.body.removeChild(t)}}),null)),t=document.createElement("div");document.body.appendChild(t),n.mount(t)},bt=V({name:"ImagePreview",props:yt,components:{[xe.name]:xe,[ue.name]:ue},emits:["update:show","close"],setup(e,{emit:r}){const n=j({visible:e.show,startX:0,moveX:0,startY:0,moveY:0,index:e.startPosition||0});X(()=>e.show,u=>n.visible=u);const t=()=>{n.visible=!1,r("close",!1),r("update:show",!1)},c=u=>{var v,g,o,i;n.startX=(g=(v=u.touches)==null?void 0:v[0])==null?void 0:g.pageX,n.startY=(i=(o=u.touches)==null?void 0:o[0])==null?void 0:i.pageY},a=u=>{var v,g,o,i;n.moveX=((g=(v=u.touches)==null?void 0:v[0])==null?void 0:g.pageX)-n.startX,n.moveY=n.startY-((i=(o=u.touches)==null?void 0:o[0])==null?void 0:i.pageY)},P=u=>{var v;n.moveX<-30?console.log("\u5411\u5DE6\u6ED1\u52A8"):n.moveX>30?console.log("\u5411\u53F3\u6ED1\u52A8"):n.moveY>30?(console.log("\u5411\u4E0A\u6ED1\u52A8"),n.index<(((v=e.images)==null?void 0:v.length)||0)&&n.index++,console.log(n.index)):n.moveY<-30&&(console.log("\u5411\u4E0B\u6ED1\u52A8"),n.index>0&&n.index--,console.log(n.index))};return()=>f(Z("van-overlay"),{show:n.visible,"z-index":"9999","custom-style":{background:"#000"},onClick:t},{default:()=>{var u,v;return[f("div",{class:"imgBox",onTouchstart:c,onTouchmove:a,onTouchend:P},[f("div",{class:"page"},[n.index+1,Ge(" / "),(u=e.images)==null?void 0:u.length]),f(Z("van-image"),{width:"100%",height:"100vh",fit:"contain",src:(v=e.images)==null?void 0:v[n.index]},null)])]}})}});const Pt=pe(bt,[["__scopeId","data-v-f61de822"]]),St=V({setup(){const e=De(),r=ze(),n=Qe(),t=j({allData:e.item,showPopover:!1,actions:[{text:"\u5207\u6362\u5C0F\u5C4F",key:"0"},{text:"\u5207\u6362\u5927\u5C4F",key:"1"},{text:"\u52A8\u753B\u5207\u6362",key:"2"}],showImage:!1,imgList:[],startPosition:0}),c=B();le(()=>{P()});const a=o=>{let i=o.split("/");return i[2]?i=i[2]:i="",i},P=()=>{var o,i;r.domain&&((i=(o=t.allData)==null?void 0:o.children)==null||i.forEach(m=>{var y;m.href=(y=m.href)==null?void 0:y.replace(a(m.href),r.domain)})),console.log(t.allData)},u=()=>{n.go(-1)},v=o=>{var i,m;t.imgList=(m=(i=t.allData)==null?void 0:i.children)==null?void 0:m.map(y=>y.href),t.startPosition=o,r.isAnimation?wt({images:t.imgList,startPosition:t.startPosition}):xt({images:t.imgList,startPosition:t.startPosition})},g=o=>{o.key==="0"&&(r.isSmallScreen=!0),o.key==="1"&&(r.isSmallScreen=!1),o.key==="2"&&(r.isAnimation=!0)};return()=>{var o,i;return f(et,null,[f(Z("van-nav-bar"),{title:"\u6700\u65B0","left-text":"\u8FD4\u56DE","left-arrow":!0,onClickLeft:u},null),f("div",{class:"content"},[f("p",{class:"title"},[(o=t.allData)==null?void 0:o.title]),(i=t.allData)==null?void 0:i.children.map((m,y)=>f(Z("van-image"),{class:"img",width:"100%",height:r.isSmallScreen?"100%":"100vh",src:m.href,fit:"contain",onClick:()=>v(y)},{loading:()=>f(Z("van-loading"),{type:"spinner",size:"20"},null),error:()=>"\u52A0\u8F7D\u5931\u8D25"}))]),f(Z("van-floating-bubble"),{icon:"setting-o",ref:c,axis:"xy"},{default:()=>f(Z("van-popover"),{show:t.showPopover,"onUpdate:show":m=>t.showPopover=m,actions:t.actions,placement:"left",theme:"dark","actions-direction":"horizontal",onSelect:g},{reference:()=>f(Z("van-icon"),{name:"setting-o",size:"24"},null)})})])}}});const pt=pe(St,[["__scopeId","data-v-486f01b5"]]);export{pt as default};
